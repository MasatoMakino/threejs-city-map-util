(()=>{"use strict";var t,e={498:(t,e,n)=>{var r,a=n(71),i=n(75),o=n(12),s=function(){function t(){}return t.initScene=function(){return new a.xsS},t.initLight=function(t){var e=new a.Mig(16777215,Math.PI/2);return t.add(e),e},t.initCamera=function(t,e,n,r,i){void 0===r&&(r=.01),void 0===i&&(i=4e11);var o=new a.cPb(45,e/n,r,i);return o.position.set(0,0,500),o.updateMatrixWorld(!1),t.add(o),o},t.initControl=function(t,e){var n;e&&(n=e.domElement);var r=new o.z(t,n);return r.update(),r},t.initRenderer=function(t,e,n){n=Object.assign({color:8947848},n);var r=new i.CP7({});return document.body.appendChild(r.domElement),r.setClearColor(new a.Ilk(n.color)),r.setSize(t,e),r.setPixelRatio(window.devicePixelRatio),r},t.initHelper=function(t){var e=new a.y8_(2e3);return t.add(e),e},t}();class c{constructor(t=0,e=0){this.lat=0,this.lng=0,this.lat=t,this.lng=e}clone(){return new c(this.lat,this.lng)}}class l{static toLatitudeLongitude(t){if(null==t||!this.validateMeshCode(t))return;const e=new c;return this.addLatLng(e,t,0,4,1,100),this.addLatLng(e,t,4,6,1/8),this.addLatLng(e,t,6,8,.0125),this.addQuadrantMeshLatLng(e,.5,t.slice(8,9)),this.addQuadrantMeshLatLng(e,.25,t.slice(9,10)),e}static validateMeshCode(t){if(null==t)return!1;if(Number.isNaN(Number(t)))return console.warn("メッシュコードが10進数以外で指定されています。変換ができないため、undefinedを返します。"),!1;switch(t.length){case 4:case 6:case 8:case 9:case 10:break;default:return console.warn(`メッシュコードの桁数${t.length}は不正です。変換ができないため、undefinedを返します。`),!1}return!0}static addLatLng(t,e,n,r,a,i=0){const o=n+(r-n)/2,s=e.slice(n,o),c=e.slice(o,r);""!==s&&""!==c&&(t.lat+=Number(s)*this.primaryLatUnit*a,t.lng+=Number(c)*a+i)}static addQuadrantMeshLatLng(t,e,n){if(""===n)return;const r=Number(n);r>4||(t.lat+=r>2?this.MeshCodeLatitudeUnit*e:0,t.lng+=r%2==0?this.MeshCodeLongitudeUnit*e:0)}static fromLongitudeLatitude(t){const e=t.clone();let n=this.subLatLng(e,this.primaryLatUnit,1,100);return n+=this.subLatLng(e,this.primaryLatUnit/8,1/8),n+=this.subLatLng(e,this.primaryLatUnit/8/10,.0125),n+=this.subQuadKmMeshLatLng(e,this.primaryLatUnit/8/10/2,.00625),n+=this.subQuadKmMeshLatLng(e,this.primaryLatUnit/8/10/2/2,.003125),n}static subLatLng(t,e,n,r=0){const a=Math.floor(t.lat/e),i=Math.floor(t.lng/n-r);return t.lat-=a*e,t.lng-=i*n+r,`${a}${i}`}static subQuadKmMeshLatLng(t,e,n){const r=t.lat>e,a=t.lng>n;return t.lat-=r?e:0,t.lng-=a?n:0,`${2*Number(r)+Number(a)+1}`}}r=l,l.primaryLatUnit=1/60*40,l.MeshCodeLatitudeUnit=r.primaryLatUnit/8/10,l.MeshCodeLongitudeUnit=.0125;var u,h=n(815);class d{static async loadObjModel(t,e){const n=await fetch(t),r=await n.text(),a=f.getMeshCode(t),i=l.toLatitudeLongitude(a),o=f.getZone(r),s=f.getShiftMeters(i,o);if(null==i||null==s)return;const c=(new h.L).parse(r).children[0];if(null==c)return;c.userData.meshCode=a,c.userData.meshCodeLatLng=i,c.userData.zone=o,c.userData.origin=e,c.geometry.translate(-s.x,s.z,0),c.geometry.rotateX(-Math.PI/2);const u=p.toTransverseMercatorXZ(i,e);return c.position.add(u),c}}class f{static getMeshCode(t){const e=t.match(/(\d+)_[\w]+_\d+\.[a-z]+$/);if(null!=e)return e[1]}static getOrigin(t,e){const n=t.match(e);if(n)return Number(n[1])}}u=f,f.getZone=t=>{const e=u.getOrigin(t,/PARAMETER\["latitude_of_origin",([\d\.]+)\]/),n=u.getOrigin(t,/PARAMETER\["central_meridian",([\d\.]+)\]/);if(e&&n)return new c(e,n)},f.getShiftMeters=(t,e)=>{if(null!=t&&null!=e)return p.toTransverseMercatorXZ(t,e)};class p{static toTransverseMercatorXZ(t,e){const n=function(t,e){const n=t*Math.PI/180,r=[1.0000007049454078,-.0025188297041239312,26435429493240994e-22,-3.4526259073074147e-9,4891830424387949e-27,-7228726045813916e-30];let a=0;for(let t=1;t<=5;t++)a+=r[t]*Math.sin(2*t*n);const i=6366807.912604471;return[t,e,i*(r[0]*n+a),i*r[0]]}(e.lat,e.lng),r=function(t,e,n){n[0];const r=n[1],a=n[2],i=n[3];function o(t){return t*Math.PI/180}const s=.08181919104281579,c=[0,.0008377318247285465,7.608527848379248e-7,1.1976455002315586e-9,24291502606542468e-28,5750164384091974e-30],l=o(t),u=o(e)-o(r),h=Math.cos(u),d=Math.sin(u),f=Math.sinh(Math.atanh(Math.sin(l))-s*Math.atanh(s*Math.sin(l))),p=Math.sqrt(1+f*f),g=Math.atan(f/h),M=Math.atanh(d/p);let m=0,b=0;const L=Math.sqrt(1+f*f);let v=0,w=0;for(let t=1;t<=5;t++){let e=2*t*g,n=2*t*M;m+=c[t]*Math.sin(e)*Math.cosh(n),b+=c[t]*Math.cos(e)*Math.sinh(n);let r=2*t*c[t];v+=r*Math.cos(e)*Math.cosh(n),w+=r*Math.sin(e)*Math.sinh(n)}v+=1;let y=[0,0,0,0];y[0]=i*(g+m)-a,y[1]=i*(M+b);const _=Math.tanh((w*L*h+v*f*d)/(v*L*h-w*f*d)),C=.9966471893188177*Math.tan(l),O=i/6378137*Math.sqrt((v*v+w*w)/(f*f+h*h)*(1+C*C));return y[2]=180*-_/Math.PI,y[3]=O,y}(t.lat,t.lng,n);return new a.Pa4(r[1],0,-r[0])}}var g=function(){function t(){this.scene=s.initScene(),s.initLight(this.scene),this.camera=s.initCamera(this.scene,1280,640),this.renderer=s.initRenderer(1280,640,{antialias:!1}),s.initControl(this.camera,this.renderer),s.initHelper(this.scene),this.load(),this.render()}return t.prototype.load=function(){return t=this,e=void 0,r=function(){var t,e,n,r,i,o,s,l,u;return function(t,e){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(h){switch(h.label){case 0:return t=new c(35.6625,139.74375),[4,d.loadObjModel("./53393599_bldg_6677.obj",t)];case 1:return e=h.sent(),[4,d.loadObjModel("./53393599_dem_6677.obj",t)];case 2:return(n=h.sent())&&(r=new a.dpR,(i=r.load("./53393599_18.jpg")).colorSpace="srgb",n.material=new a.Wid({map:i}),this.scene.add(n)),e&&(e.material=new a.vBJ({color:16777215,transparent:!0,opacity:.5}),this.scene.add(e),o=new a.Kj0(new a.xo$(10,10),new a.vBJ),s=new c(35.65864183184921,139.74544075634395),l=p.toTransverseMercatorXZ(s,e.userData.origin),o.position.copy(l),this.scene.add(o),(u=o.clone()).position.y=333,this.scene.add(u)),[2]}}))},new((n=void 0)||(n=Promise))((function(a,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}));var t,e,n,r},t.prototype.render=function(){var t=this;requestAnimationFrame((function(){t.render()})),this.renderer.render(this.scene,this.camera)},t}();window.onload=function(){new g}}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.m=e,t=[],r.O=(e,n,a,i)=>{if(!n){var o=1/0;for(u=0;u<t.length;u++){for(var[n,a,i]=t[u],s=!0,c=0;c<n.length;c++)(!1&i||o>=i)&&Object.keys(r.O).every((t=>r.O[t](n[c])))?n.splice(c--,1):(s=!1,i<o&&(o=i));if(s){t.splice(u--,1);var l=a();void 0!==l&&(e=l)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[n,a,i]},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={577:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var a,i,[o,s,c]=n,l=0;if(o.some((e=>0!==t[e]))){for(a in s)r.o(s,a)&&(r.m[a]=s[a]);if(c)var u=c(r)}for(e&&e(n);l<o.length;l++)i=o[l],r.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return r.O(u)},n=self.webpackChunk_masatomakino_threejs_city_map_util=self.webpackChunk_masatomakino_threejs_city_map_util||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var a=r.O(void 0,[736],(()=>r(498)));a=r.O(a)})();