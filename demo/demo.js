(()=>{"use strict";var t,e={498:(t,e,n)=>{var r,a=n(75),i=n(12),s=function(){function t(){}return t.initScene=function(){return new a.xsS},t.initLight=function(t){var e=new a.Mig(16777215,Math.PI/2);return t.add(e),e},t.initCamera=function(t,e,n,r,i){void 0===r&&(r=.01),void 0===i&&(i=4e11);var s=new a.cPb(45,e/n,r,i);return s.position.set(0,0,500),s.updateMatrixWorld(!1),t.add(s),s},t.initControl=function(t,e){var n;e&&(n=e.domElement);var r=new i.z(t,n);return r.update(),r},t.initRenderer=function(t,e,n){n=Object.assign({color:8947848},n);var r=new a.CP7({});return document.body.appendChild(r.domElement),r.setClearColor(new a.Ilk(n.color)),r.setSize(t,e),r.setPixelRatio(window.devicePixelRatio),r},t.initHelper=function(t){var e=new a.y8_(2e3);return t.add(e),e},t}();class o{constructor(t=0,e=0){this.lat=0,this.lng=0,this.lat=t,this.lng=e}clone(){return new o(this.lat,this.lng)}}class c{static toLatitudeLongitude(t){if(null==t||!this.validateMeshCode(t))return;const e=new o;return this.addLatLng(e,t,0,4,1,100),this.addLatLng(e,t,4,6,1/8),this.addLatLng(e,t,6,8,.0125),this.addQuadrantMeshLatLng(e,.5,t.slice(8,9)),this.addQuadrantMeshLatLng(e,.25,t.slice(9,10)),e}static validateMeshCode(t){if(null==t)return!1;if(Number.isNaN(Number(t)))return console.warn("メッシュコードが10進数以外で指定されています。変換ができないため、undefinedを返します。"),!1;switch(t.length){case 4:case 6:case 8:case 9:case 10:break;default:return console.warn(`メッシュコードの桁数${t.length}は不正です。変換ができないため、undefinedを返します。`),!1}return!0}static addLatLng(t,e,n,r,a,i=0){const s=n+(r-n)/2,o=e.slice(n,s),c=e.slice(s,r);""!==o&&""!==c&&(t.lat+=Number(o)*this.primaryLatUnit*a,t.lng+=Number(c)*a+i)}static addQuadrantMeshLatLng(t,e,n){if(""===n)return;const r=Number(n);r>4||(t.lat+=r>2?this.MeshCodeLatitudeUnit*e:0,t.lng+=r%2==0?this.MeshCodeLongitudeUnit*e:0)}static fromLongitudeLatitude(t){const e=t.clone();let n=this.subLatLng(e,this.primaryLatUnit,1,100);return n+=this.subLatLng(e,this.primaryLatUnit/8,1/8),n+=this.subLatLng(e,this.primaryLatUnit/8/10,.0125),n+=this.subQuadKmMeshLatLng(e,this.primaryLatUnit/8/10/2,.00625),n+=this.subQuadKmMeshLatLng(e,this.primaryLatUnit/8/10/2/2,.003125),n}static subLatLng(t,e,n,r=0){const a=Math.floor(t.lat/e),i=Math.floor(t.lng/n-r);return t.lat-=a*e,t.lng-=i*n+r,`${a}${i}`}static subQuadKmMeshLatLng(t,e,n){const r=t.lat>e,a=t.lng>n;return t.lat-=r?e:0,t.lng-=a?n:0,`${2*Number(r)+Number(a)+1}`}}r=c,c.primaryLatUnit=1/60*40,c.MeshCodeLatitudeUnit=r.primaryLatUnit/8/10,c.MeshCodeLongitudeUnit=.0125;var l,u=n(815);class h{static async loadObjModel(t,e){const n=await fetch(t),r=await n.text(),a=d.getMeshCode(t),i=c.toLatitudeLongitude(a),s=d.getZone(r),o=d.getShiftMeters(i,s);if(null==i||null==o)return;const l=(new u.L).parse(r).children[0];if(null==l)return;l.userData.meshCode=a,l.userData.meshCodeLatLng=i,l.userData.zone=s,l.userData.origin=e,l.geometry.translate(-o.x,o.z,0),l.geometry.rotateX(-Math.PI/2);const h=f.toTransverseMercatorXZ(i,e);return l.position.add(h),l}}class d{static getMeshCode(t){const e=t.match(/(\d+)_[\w]+_\d+\.[a-z]+$/);if(null!=e)return e[1]}static getOrigin(t,e){const n=t.match(e);if(n)return Number(n[1])}}l=d,d.getZone=t=>{const e=l.getOrigin(t,/PARAMETER\["latitude_of_origin",([\d\.]+)\]/),n=l.getOrigin(t,/PARAMETER\["central_meridian",([\d\.]+)\]/);if(e&&n)return new o(e,n)},d.getShiftMeters=(t,e)=>{if(null!=t&&null!=e)return f.toTransverseMercatorXZ(t,e)};class f{static toTransverseMercatorXZ(t,e){const n=function(t,e){const n=t*Math.PI/180,r=[1.0000007049454078,-.0025188297041239312,26435429493240994e-22,-3.4526259073074147e-9,4891830424387949e-27,-7228726045813916e-30];let a=0;for(let t=1;t<=5;t++)a+=r[t]*Math.sin(2*t*n);const i=6366807.912604471;return[t,e,i*(r[0]*n+a),i*r[0]]}(e.lat,e.lng),r=function(t,e,n){n[0];const r=n[1],a=n[2],i=n[3];function s(t){return t*Math.PI/180}const o=.08181919104281579,c=[0,.0008377318247285465,7.608527848379248e-7,1.1976455002315586e-9,24291502606542468e-28,5750164384091974e-30],l=s(t),u=s(e)-s(r),h=Math.cos(u),d=Math.sin(u),f=Math.sinh(Math.atanh(Math.sin(l))-o*Math.atanh(o*Math.sin(l))),g=Math.sqrt(1+f*f),p=Math.atan(f/h),M=Math.atanh(d/g);let m=0,L=0;const b=Math.sqrt(1+f*f);let v=0,w=0;for(let t=1;t<=5;t++){let e=2*t*p,n=2*t*M;m+=c[t]*Math.sin(e)*Math.cosh(n),L+=c[t]*Math.cos(e)*Math.sinh(n);let r=2*t*c[t];v+=r*Math.cos(e)*Math.cosh(n),w+=r*Math.sin(e)*Math.sinh(n)}v+=1;let y=[0,0,0,0];y[0]=i*(p+m)-a,y[1]=i*(M+L);const _=Math.tanh((w*b*h+v*f*d)/(v*b*h-w*f*d)),C=.9966471893188177*Math.tan(l),O=i/6378137*Math.sqrt((v*v+w*w)/(f*f+h*h)*(1+C*C));return y[2]=180*-_/Math.PI,y[3]=O,y}(t.lat,t.lng,n);return new a.Pa4(r[1],0,-r[0])}}var g=function(){function t(){this.scene=s.initScene(),s.initLight(this.scene),this.camera=s.initCamera(this.scene,1280,640),this.renderer=s.initRenderer(1280,640,{antialias:!1}),s.initControl(this.camera,this.renderer),s.initHelper(this.scene),this.load(),this.render()}return t.prototype.load=function(){return t=this,e=void 0,r=function(){var t,e,n,r,i,s,c,l,u;return function(t,e){var n,r,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}(this,(function(d){switch(d.label){case 0:return t=new o(35.6625,139.74375),[4,h.loadObjModel("./53393599_bldg_6677.obj",t)];case 1:return e=d.sent(),[4,h.loadObjModel("./53393599_dem_6677.obj",t)];case 2:return(n=d.sent())&&(r=new a.dpR,(i=r.load("./53393599_18.jpg")).colorSpace="srgb",n.material=new a.Wid({map:i}),this.scene.add(n)),e&&(e.material=new a.vBJ({color:16777215,transparent:!0,opacity:.5}),this.scene.add(e),s=new a.Kj0(new a.xo$(10,10),new a.vBJ),c=new o(35.65864183184921,139.74544075634395),l=f.toTransverseMercatorXZ(c,e.userData.origin),s.position.copy(l),this.scene.add(s),(u=s.clone()).position.y=333,this.scene.add(u)),[2]}}))},new((n=void 0)||(n=Promise))((function(a,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function o(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,o)}c((r=r.apply(t,e||[])).next())}));var t,e,n,r},t.prototype.render=function(){var t=this;requestAnimationFrame((function(){t.render()})),this.renderer.render(this.scene,this.camera)},t}();window.onload=function(){new g}}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.m=e,t=[],r.O=(e,n,a,i)=>{if(!n){var s=1/0;for(u=0;u<t.length;u++){for(var[n,a,i]=t[u],o=!0,c=0;c<n.length;c++)(!1&i||s>=i)&&Object.keys(r.O).every((t=>r.O[t](n[c])))?n.splice(c--,1):(o=!1,i<s&&(s=i));if(o){t.splice(u--,1);var l=a();void 0!==l&&(e=l)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[n,a,i]},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={577:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var a,i,[s,o,c]=n,l=0;if(s.some((e=>0!==t[e]))){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(c)var u=c(r)}for(e&&e(n);l<s.length;l++)i=s[l],r.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return r.O(u)},n=self.webpackChunk_masatomakino_threejs_city_map_util=self.webpackChunk_masatomakino_threejs_city_map_util||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var a=r.O(void 0,[736],(()=>r(498)));a=r.O(a)})();